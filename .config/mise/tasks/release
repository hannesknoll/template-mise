#!/usr/bin/env nu


def main [
    version: string
    --dry
] {

    git-cliff -o CHANGELOG.md

    if not $dry {
        try {
            git add CHANGELOG.md
        } catch { }
    }

    let has_changes = (git diff --staged --quiet --exit-code | complete).exit_code != 0

    if $has_changes and not $dry {
        git commit -m $"docs(changelog): update for v($version)"
        git tag -a $version -m $"Release ($version)"
    }

    echo $"Successfully created release ($version)"
    echo "To publish, run: git push && git push --tags"

}


